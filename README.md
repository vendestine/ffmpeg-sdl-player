# ffmpeg4.2.1 + SDL2开发播放器

## 播放器框架和解复用模块
QT使用ffmepg动态库的项目环境配置，请参照环境搭建

先看一下文件结构
[图片]

log.h 和 log.cpp是日志实现，比较简单，而且这不是核心内容，只是个辅助工具。

thread.h是一个抽象类，因为之后可能有很多种线程，例如解复用线程，视频/音频解码线程，视频/音频输出线程，所以这里设计了一个线程抽象类。
为什么不用模板？
因为模板一般是针对成员变量的类型不同，但是成员函数的处理方式一致；这里其实成员变量类型基本不变，然后处理方式其实每种线程差别还是挺大的，所以不用模板。

// 抽象类
class Thread
{
public:
    Thread() {} // 构造函数
    ~Thread() { // 析构函数
        if(thread_) { // 如果线程存在
            Thread::Stop(); // 停止线程
        }
    }

    int Start() {} // 启动线程的函数，未实现

    int Stop() { // 停止线程的函数
        abort_ = 1; // 设置中止标志为1，表示线程应当结束
        if(thread_) { // 如果线程存在
            thread_->join(); // 等待线程结束
            delete thread_; // 释放线程对象
            thread_ = NULL; // 将线程指针设为NULL，避免悬挂指针
        }
        return 0; // 成功返回
    }

    virtual void Run() = 0; // 纯虚函数，子类必须实现该方法

protected:
    int abort_ = 0; // 用于控制线程的中止状态
    std::thread *thread_ = NULL; // 指向实际的线程对象
};

接下来就是重点 demuxthread.h和demuxthread.cpp，它是一个解复用线程，解复用线程的主要作用参考下图：
[图片]


主要就是Init()中 完成初始化
[图片]
然后真正的线程函数Run()中 完成数据包的读取
[图片]
最后停止线程的时候，关闭输入流，释放资源
[图片]

[图片]